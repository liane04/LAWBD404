@{
    ViewData["Title"] = "Editar Anúncio";
}

<div class="container my-5 py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10 col-xl-9">
            <!-- Cabeçalho -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1 fw-bold">
                        <i class="bi bi-pencil-square text-primary me-2"></i>Editar Anúncio
                    </h2>
                    <p class="text-muted mb-0">Atualize as informações do seu veículo</p>
                </div>
                <a asp-controller="Utilizadores" asp-action="Perfil" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left me-2"></i>Voltar
                </a>
            </div>

            <form id="editAnuncioForm">
                <!-- Card de Estado do Anúncio -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-primary text-white py-3">
                        <h4 class="mb-0">
                            <i class="bi bi-info-circle me-2"></i>Estado do Anúncio
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="estadoAnuncio" class="form-label fw-semibold">
                                    <i class="bi bi-toggle2-on text-primary me-2"></i>Estado Atual
                                    <span class="text-danger">*</span>
                                </label>
                                <select class="form-select form-select-lg" id="estadoAnuncio" required>
                                    <option value="ativo" selected>Ativo</option>
                                    <option value="reservado">Reservado</option>
                                    <option value="vendido">Vendido</option>
                                    <option value="pausado">Pausado</option>
                                </select>
                                <div class="form-text">
                                    <i class="bi bi-lightbulb text-warning me-1"></i>
                                    Altere o estado conforme o progresso da venda
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="estado-info-box p-3 rounded h-100 d-flex align-items-center" id="estadoInfoBox">
                                    <div>
                                        <div class="estado-badge mb-2">
                                            <span class="badge bg-success fs-6" id="estadoBadge">
                                                <i class="bi bi-check-circle-fill me-1"></i>ATIVO
                                            </span>
                                        </div>
                                        <p class="mb-0 small text-muted" id="estadoDescricao">
                                            Anúncio visível para todos os utilizadores
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Notas sobre Estados -->
                        <div class="alert alert-info border-0 mt-3 mb-0">
                            <h6 class="fw-bold mb-2"><i class="bi bi-info-circle-fill me-2"></i>Estados Disponíveis</h6>
                            <ul class="mb-0 ps-3 small">
                                <li><strong>Ativo:</strong> O anúncio está visível e disponível para compra</li>
                                <li><strong>Reservado:</strong> Alguém pagou o sinal e está no processo de compra</li>
                                <li><strong>Vendido:</strong> O veículo foi vendido e a transação está concluída</li>
                                <li><strong>Pausado:</strong> Temporariamente invisível (útil se não quer vender agora)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Card de Informação Principal -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-primary text-white py-3">
                        <h4 class="mb-0">
                            <i class="bi bi-info-circle me-2"></i>Informação Principal
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="titulo" class="form-label fw-semibold">
                                    <i class="bi bi-pencil text-primary me-2"></i>Título do Anúncio
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control form-control-lg" id="titulo"
                                       value="BMW Série 3 320d Pack M" required>
                            </div>

                            <div class="col-md-6">
                                <label for="preco" class="form-label fw-semibold">
                                    <i class="bi bi-currency-euro text-primary me-2"></i>Preço
                                    <span class="text-danger">*</span>
                                </label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">
                                        <i class="bi bi-currency-euro"></i>
                                    </span>
                                    <input type="number" class="form-control" id="preco"
                                           value="28500" required>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label for="negociavel" class="form-label fw-semibold">
                                    <i class="bi bi-chat-dots text-primary me-2"></i>Negociável?
                                </label>
                                <select id="negociavel" class="form-select form-select-lg">
                                    <option value="sim" selected>Sim, aceito propostas</option>
                                    <option value="nao">Não, preço fixo</option>
                                </select>
                            </div>

                            <div class="col-12">
                                <div class="alert alert-info border-0 d-flex align-items-start">
                                    <i class="bi bi-info-circle-fill me-3 fs-5 mt-1"></i>
                                    <div>
                                        <h6 class="mb-2 fw-bold">Valor do Sinal para Reserva</h6>
                                        <p class="mb-2 small">
                                            Defina o valor que os compradores devem pagar para reservar o veículo.
                                        </p>
                                        <div class="row g-2 align-items-end mt-3">
                                            <div class="col-md-4">
                                                <label for="valorSinal" class="form-label fw-semibold mb-1">
                                                    <i class="bi bi-bookmark-check text-primary me-1"></i>Valor do Sinal
                                                    <span class="text-danger">*</span>
                                                </label>
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <i class="bi bi-currency-euro"></i>
                                                    </span>
                                                    <input type="number" class="form-control" id="valorSinal"
                                                           value="500" min="100" max="5000" required>
                                                </div>
                                                <div class="form-text">Mínimo: 100€ | Máximo: 5.000€</div>
                                            </div>
                                            <div class="col-md-8">
                                                <div class="d-flex gap-2 flex-wrap">
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="setValorSinal(250)">250€</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="setValorSinal(500)">500€</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="setValorSinal(1000)">1.000€</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="setValorSinal(1500)">1.500€</button>
                                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="setValorSinal(2000)">2.000€</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-12">
                                <label for="descricao" class="form-label fw-semibold">
                                    <i class="bi bi-file-text text-primary me-2"></i>Descrição
                                    <span class="text-danger">*</span>
                                </label>
                                <textarea class="form-control" id="descricao" rows="5" required>Carro nacional em excelente estado, com todas as revisões na marca. Pack M completo, interior em pele, jantes 18", sistema de navegação profissional. Único dono, não fumador.</textarea>
                                <div class="form-text">
                                    <span id="charCount">169</span>/500 caracteres
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card de Detalhes do Veículo -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-primary text-white py-3">
                        <h4 class="mb-0">
                            <i class="bi bi-car-front me-2"></i>Detalhes do Veículo
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="marca" class="form-label fw-semibold">
                                    <i class="bi bi-award text-primary me-2"></i>Marca
                                    <span class="text-danger">*</span>
                                </label>
                                <select id="marca" class="form-select form-select-lg" required>
                                    <option value="audi">Audi</option>
                                    <option value="bmw" selected>BMW</option>
                                    <option value="mercedes">Mercedes-Benz</option>
                                    <option value="vw">Volkswagen</option>
                                    <option value="outro">Outra</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="modelo" class="form-label fw-semibold">
                                    <i class="bi bi-tag text-primary me-2"></i>Modelo
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control form-control-lg" id="modelo"
                                       value="Série 3" required>
                            </div>

                            <div class="col-md-4">
                                <label for="ano" class="form-label fw-semibold">
                                    <i class="bi bi-calendar-event text-primary me-2"></i>Ano
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="number" class="form-control form-control-lg" id="ano"
                                       value="2019" min="1980" max="2025" required>
                            </div>

                            <div class="col-md-4">
                                <label for="kms" class="form-label fw-semibold">
                                    <i class="bi bi-speedometer2 text-primary me-2"></i>Quilómetros
                                    <span class="text-danger">*</span>
                                </label>
                                <input type="number" class="form-control form-control-lg" id="kms"
                                       value="98000" required>
                            </div>

                            <div class="col-md-4">
                                <label for="potencia" class="form-label fw-semibold">
                                    <i class="bi bi-lightning-charge text-primary me-2"></i>Potência (cv)
                                </label>
                                <input type="number" class="form-control form-control-lg" id="potencia"
                                       value="190">
                            </div>

                            <div class="col-md-6">
                                <label for="combustivel" class="form-label fw-semibold">
                                    <i class="bi bi-fuel-pump text-primary me-2"></i>Combustível
                                    <span class="text-danger">*</span>
                                </label>
                                <select id="combustivel" class="form-select form-select-lg" required>
                                    <option value="diesel" selected>Diesel</option>
                                    <option value="gasolina">Gasolina</option>
                                    <option value="eletrico">Elétrico</option>
                                    <option value="hibrido">Híbrido</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="transmissao" class="form-label fw-semibold">
                                    <i class="bi bi-gear text-primary me-2"></i>Transmissão
                                    <span class="text-danger">*</span>
                                </label>
                                <select id="transmissao" class="form-select form-select-lg" required>
                                    <option value="manual" selected>Manual</option>
                                    <option value="automatica">Automática</option>
                                    <option value="semiautomatica">Semi-automática</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card de Fotografias -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-header bg-primary text-white py-3">
                        <h4 class="mb-0">
                            <i class="bi bi-images me-2"></i>Fotografias
                        </h4>
                    </div>
                    <div class="card-body p-4">
                        <div class="mb-4">
                            <h6 class="fw-semibold mb-3">Fotos Atuais</h6>
                            <div class="row g-3">
                                <div class="col-6 col-md-3">
                                    <div class="edit-image-card position-relative">
                                        <img src="https://placehold.co/300x200/2563eb/ffffff?text=Foto+1" class="img-fluid rounded" alt="Foto 1">
                                        <span class="badge bg-primary position-absolute top-0 start-0 m-2">Principal</span>
                                        <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="edit-image-card position-relative">
                                        <img src="https://placehold.co/300x200/64748b/ffffff?text=Foto+2" class="img-fluid rounded" alt="Foto 2">
                                        <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-6 col-md-3">
                                    <div class="edit-image-card position-relative">
                                        <img src="https://placehold.co/300x200/64748b/ffffff?text=Foto+3" class="img-fluid rounded" alt="Foto 3">
                                        <button type="button" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <label for="novasImagens" class="form-label fw-semibold">
                                <i class="bi bi-cloud-upload text-primary me-2"></i>Adicionar Mais Fotografias
                            </label>
                            <input class="form-control form-control-lg" type="file" id="novasImagens" multiple accept="image/*">
                            <div class="form-text">
                                <i class="bi bi-info-circle me-1"></i>
                                Formatos aceites: JPG, PNG. Máximo: 10 fotos no total.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botões de Ação -->
                <div class="card shadow-sm border-0 mb-4">
                    <div class="card-body p-4">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <button type="submit" class="btn btn-success btn-lg w-100">
                                    <i class="bi bi-check-circle me-2"></i>Guardar Alterações
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button type="button" class="btn btn-outline-secondary btn-lg w-100">
                                    <i class="bi bi-x-circle me-2"></i>Cancelar
                                </button>
                            </div>
                            <div class="col-12">
                                <hr>
                            </div>
                            <div class="col-12">
                                <button type="button" class="btn btn-outline-danger w-100" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                    <i class="bi bi-trash me-2"></i>Apagar Anúncio Permanentemente
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal de Confirmação de Exclusão -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteModalLabel">
                    <i class="bi bi-exclamation-triangle me-2"></i>Confirmar Exclusão
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Tem a certeza que deseja apagar este anúncio permanentemente?</p>
                <div class="alert alert-warning mb-0">
                    <i class="bi bi-exclamation-circle me-2"></i>
                    <strong>Atenção:</strong> Esta ação não pode ser desfeita!
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger">
                    <i class="bi bi-trash me-2"></i>Sim, Apagar Anúncio
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Atualizar informação de estado dinamicamente
        const estadoSelect = document.getElementById('estadoAnuncio');
        const estadoBadge = document.getElementById('estadoBadge');
        const estadoDescricao = document.getElementById('estadoDescricao');
        const estadoInfoBox = document.getElementById('estadoInfoBox');

        const estadosInfo = {
            'ativo': {
                badge: '<i class="bi bi-check-circle-fill me-1"></i>ATIVO',
                classe: 'bg-success',
                descricao: 'Anúncio visível para todos os utilizadores',
                boxColor: '#d1fae5'
            },
            'reservado': {
                badge: '<i class="bi bi-bookmark-check-fill me-1"></i>RESERVADO',
                classe: 'bg-warning text-dark',
                descricao: 'Veículo reservado - aguarda conclusão da venda',
                boxColor: '#fef3c7'
            },
            'vendido': {
                badge: '<i class="bi bi-check2-circle me-1"></i>VENDIDO',
                classe: 'bg-info text-dark',
                descricao: 'Veículo vendido - transação concluída',
                boxColor: '#dbeafe'
            },
            'pausado': {
                badge: '<i class="bi bi-pause-circle-fill me-1"></i>PAUSADO',
                classe: 'bg-secondary',
                descricao: 'Anúncio temporariamente invisível',
                boxColor: '#e2e8f0'
            }
        };

        estadoSelect.addEventListener('change', function() {
            const estado = this.value;
            const info = estadosInfo[estado];

            // Atualizar badge
            estadoBadge.className = `badge ${info.classe} fs-6`;
            estadoBadge.innerHTML = info.badge;

            // Atualizar descrição
            estadoDescricao.textContent = info.descricao;

            // Atualizar cor da box
            estadoInfoBox.style.backgroundColor = info.boxColor;
        });

        // Função para definir valor do sinal
        function setValorSinal(valor) {
            document.getElementById('valorSinal').value = valor;
        }

        // Contador de caracteres
        const descricao = document.getElementById('descricao');
        const charCount = document.getElementById('charCount');

        descricao.addEventListener('input', function() {
            charCount.textContent = this.value.length;
        });

        // Submit do formulário
        document.getElementById('editAnuncioForm').addEventListener('submit', function(e) {
            e.preventDefault();

            // Simular sucesso
            alert('Anúncio atualizado com sucesso!');

            // Feedback visual
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-check-circle me-2"></i>Guardado!';
            submitBtn.disabled = true;

            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 2000);
        });
    </script>
}
