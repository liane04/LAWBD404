@{
    ViewData["Title"] = "FAQ";
}

<div class="container py-5" style="max-width: 1100px;">
    <div class="text-center mb-5">
        <p class="text-primary fw-bold mb-1" style="letter-spacing: 0.08em;">SUPORTE 404 RIDE</p>
        <h1 class="fw-bold mb-3">Perguntas Frequentes</h1>
        <p class="text-muted mb-0">Encontre respostas rápidas sobre conta, anúncios, reservas, mensagens, pagamentos e segurança.</p>
    </div>

    <div class="row g-4">
        <div class="col-12 col-lg-4">
            <div class="card shadow-sm border-0 mb-3">
                <div class="card-body">
                    <div class="input-group input-group-lg">
                        <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                        <input id="faqSearch" type="text" class="form-control" placeholder="Pesquise por 'anuncio', '2FA', 'reserva'..." />
                    </div>
                    <div class="small text-muted mt-2">Sugestões: 2FA, registo, criar anúncio, imagens, reservas, visitas, denuncias, faturação.</div>
                </div>
            </div>

            <div class="list-group shadow-sm" id="faqCategories">
                <a href="#cat-conta" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                    <i class="bi bi-person-check me-2 text-primary"></i>Conta e Acesso
                </a>
                <a href="#cat-anuncios" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="bi bi-megaphone me-2 text-primary"></i>Anúncios
                </a>
                <a href="#cat-reservas" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="bi bi-calendar-check me-2 text-primary"></i>Reservas e Visitas
                </a>
                <a href="#cat-mensagens" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="bi bi-chat-dots me-2 text-primary"></i>Mensagens e Alertas
                </a>
                <a href="#cat-pagamentos" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="bi bi-credit-card me-2 text-primary"></i>Pagamentos e Faturação
                </a>
                <a href="#cat-seguranca" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="bi bi-shield-lock me-2 text-primary"></i>Segurança e Denúncias
                </a>
                <a href="#cat-privacidade" class="list-group-item list-group-item-action" data-bs-toggle="list">
                    <i class="bi bi-shield-check me-2 text-primary"></i>Dados e Privacidade
                </a>
            </div>

            <div class="card mt-4 border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="fw-bold mb-2"><i class="bi bi-life-preserver me-1 text-primary"></i>Ainda precisa de ajuda?</h6>
                    <p class="text-muted mb-3">Fale com o assistente 404 ou contacte suporte.</p>
                    <div class="d-grid gap-2">
                        <button id="openChatFromFaq" class="btn btn-primary"><i class="bi bi-robot me-1"></i> Abrir Assistente</button>
                        <a href="mailto:404ride@gmail.com" class="btn btn-outline-primary"><i class="bi bi-envelope me-1"></i> suporte@404ride</a>
                    </div>
                    <div class="small text-muted mt-2">Tempo médio de resposta: &lt; 24h úteis.</div>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-8">
            <div class="tab-content" id="faqContent">
                <!-- Conta e Acesso -->
                <div class="tab-pane fade show active" id="cat-conta">
                    <div class="accordion" id="accConta">
                        <div class="accordion-item faq-item" data-tags="registo conta criar cadastro login">
                            <h2 class="accordion-header" id="c1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#c1" aria-expanded="true" aria-controls="c1">
                                    Como crio uma conta?
                                </button>
                            </h2>
                            <div id="c1" class="accordion-collapse collapse show" data-bs-parent="#accConta">
                                <div class="accordion-body">
                                    Vá a <a asp-controller="Utilizadores" asp-action="Registar" class="link-primary">Registar</a>, escolha se quer ser Comprador ou Vendedor e preencha nome, email, username e password. Recebe confirmação no email.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="login password autenticação dois fatores 2fa segurança">
                            <h2 class="accordion-header" id="c2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c2" aria-controls="c2">
                                    Como funciona o login com autenticação de dois fatores (2FA)?
                                </button>
                            </h2>
                            <div id="c2" class="accordion-collapse collapse" data-bs-parent="#accConta">
                                <div class="accordion-body">
                                    Ative 2FA em Perfil &gt; Definições &gt; Segurança. A app Authenticator gera códigos de 6 dígitos. No login, após email/password, introduza esse código. Códigos de recuperação são gerados para emergências.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="password alterar redefinir recuperar palavra passe">
                            <h2 class="accordion-header" id="c3h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c3" aria-controls="c3">
                                    Como altero ou recupero a minha password?
                                </button>
                            </h2>
                            <div id="c3" class="accordion-collapse collapse" data-bs-parent="#accConta">
                                <div class="accordion-body">
                                    Alterar: Perfil &gt; Definições &gt; Segurança &gt; Alterar Password. Recuperar: em <a asp-controller="Utilizadores" asp-action="Login" class="link-primary">Login</a>, escolha “Esqueci-me da password” e siga o link enviado por email.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="roles vendedor comprador mudar tipo conta">
                            <h2 class="accordion-header" id="c4h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#c4" aria-controls="c4">
                                    Posso ser comprador e vendedor na mesma conta?
                                </button>
                            </h2>
                            <div id="c4" class="accordion-collapse collapse" data-bs-parent="#accConta">
                                <div class="accordion-body">
                                    Sim. Crie a conta como comprador e, ao querer vender, peça validação como vendedor (dados fiscais e contacto). O administrador ativa o perfil de vendedor mantendo o mesmo login.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Anúncios -->
                <div class="tab-pane fade" id="cat-anuncios">
                    <div class="accordion" id="accAnuncios">
                        <div class="accordion-item faq-item" data-tags="anuncio criar publicar imagens fotos requisitos">
                            <h2 class="accordion-header" id="a1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#a1" aria-controls="a1">
                                    Como publico um anúncio?
                                </button>
                            </h2>
                            <div id="a1" class="accordion-collapse collapse show" data-bs-parent="#accAnuncios">
                                <div class="accordion-body">
                                    Aceda a <a asp-controller="Anuncios" asp-action="Create" class="link-primary">Criar Anúncio</a>, preencha dados do veículo, carregue imagens (JPEG/PNG/WebP até 10 MB) e submeta. O anúncio entra em validação.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="validacao aprovacao tempo publicar revisao">
                            <h2 class="accordion-header" id="a2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a2" aria-controls="a2">
                                    Quanto tempo demora a validação?
                                </button>
                            </h2>
                            <div id="a2" class="accordion-collapse collapse" data-bs-parent="#accAnuncios">
                                <div class="accordion-body">
                                    O objetivo é validar em 24h úteis. Receberá notificação quando for aprovado ou se precisarmos de ajustes (ex.: fotos desfocadas, dados incompletos).
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="editar anuncio atualizar pausar remover destacar topo">
                            <h2 class="accordion-header" id="a3h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a3" aria-controls="a3">
                                    Posso editar ou pausar um anúncio depois de publicado?
                                </button>
                            </h2>
                            <div id="a3" class="accordion-collapse collapse" data-bs-parent="#accAnuncios">
                                <div class="accordion-body">
                                    Sim. Em Perfil &gt; Meus Anúncios pode editar dados, atualizar fotos, pausar ou remover. Se remover, o anúncio deixa de ser listado e as reservas associadas são canceladas.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="imagens fotos limites dimensoes">
                            <h2 class="accordion-header" id="a4h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a4" aria-controls="a4">
                                    Quais os requisitos para fotos?
                                </button>
                            </h2>
                            <div id="a4" class="accordion-collapse collapse" data-bs-parent="#accAnuncios">
                                <div class="accordion-body">
                                    Formatos: JPEG/PNG/WebP. Tamanho: até 10 MB cada. Use fotos nítidas do exterior, interior, painel e documentação (sem expor dados sensíveis).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reservas e Visitas -->
                <div class="tab-pane fade" id="cat-reservas">
                    <div class="accordion" id="accReservas">
                        <div class="accordion-item faq-item" data-tags="reserva sinal visita agendar">
                            <h2 class="accordion-header" id="r1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#r1" aria-controls="r1">
                                    Como reservo ou agendo uma visita?
                                </button>
                            </h2>
                            <div id="r1" class="accordion-collapse collapse show" data-bs-parent="#accReservas">
                                <div class="accordion-body">
                                    Na página do anúncio use “Reservar” ou “Agendar Visita”. Escolha data/hora disponível do vendedor. Receberá confirmação e pode ver o histórico em Perfil &gt; Reservas/Visitas.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="cancelar reagendar politica">
                            <h2 class="accordion-header" id="r2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#r2" aria-controls="r2">
                                    Posso cancelar ou reagendar?
                                </button>
                            </h2>
                            <div id="r2" class="accordion-collapse collapse" data-bs-parent="#accReservas">
                                <div class="accordion-body">
                                    Sim. Fale com o vendedor na conversa do anúncio ou cancele pelo painel. Respeite prazos combinados; se houver sinal, verifique as condições acordadas.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="disponibilidade vendedor horarios slots">
                            <h2 class="accordion-header" id="r3h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#r3" aria-controls="r3">
                                    Como são definidos os horários disponíveis?
                                </button>
                            </h2>
                            <div id="r3" class="accordion-collapse collapse" data-bs-parent="#accReservas">
                                <div class="accordion-body">
                                    O vendedor configura os horários em Perfil &gt; Disponibilidade. Apenas slots livres são exibidos para marcação de visitas.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mensagens e Alertas -->
                <div class="tab-pane fade" id="cat-mensagens">
                    <div class="accordion" id="accMensagens">
                        <div class="accordion-item faq-item" data-tags="mensagens chat conversas compradores vendedores">
                            <h2 class="accordion-header" id="m1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#m1" aria-controls="m1">
                                    Onde vejo as conversas?
                                </button>
                            </h2>
                            <div id="m1" class="accordion-collapse collapse show" data-bs-parent="#accMensagens">
                                <div class="accordion-body">
                                    Depois de contactar um anúncio, a conversa fica no painel de Mensagens e no Perfil. Notificamos novas mensagens por badge e, se ativo, por email.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="alertas favoritos filtros guardados pesquisas">
                            <h2 class="accordion-header" id="m2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#m2" aria-controls="m2">
                                    Como recebo alertas de novos anúncios?
                                </button>
                            </h2>
                            <div id="m2" class="accordion-collapse collapse" data-bs-parent="#accMensagens">
                                <div class="accordion-body">
                                    Guarde uma pesquisa na listagem de anúncios. O sistema verifica novos anúncios que correspondam aos filtros e cria notificações automáticas (seção Pesquisas Guardadas no Perfil).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pagamentos e Faturação -->
                <div class="tab-pane fade" id="cat-pagamentos">
                    <div class="accordion" id="accPagamentos">
                        <div class="accordion-item faq-item" data-tags="pagamento sinal valor reserva">
                            <h2 class="accordion-header" id="p1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#p1" aria-controls="p1">
                                    Como funciona o pagamento do sinal?
                                </button>
                            </h2>
                            <div id="p1" class="accordion-collapse collapse show" data-bs-parent="#accPagamentos">
                                <div class="accordion-body">
                                    O valor de sinal é combinado entre comprador e vendedor. Registe-o no fluxo de Reserva para ficar associado ao anúncio e visível no histórico.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="fatura recibo dados fiscais nif">
                            <h2 class="accordion-header" id="p2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#p2" aria-controls="p2">
                                    Posso obter fatura ou recibo?
                                </button>
                            </h2>
                            <div id="p2" class="accordion-collapse collapse" data-bs-parent="#accPagamentos">
                                <div class="accordion-body">
                                    Vendedores podem preencher dados de faturação e NIF no Perfil. A emissão de recibo/fatura é tratada diretamente entre comprador e vendedor.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Segurança e Denúncias -->
                <div class="tab-pane fade" id="cat-seguranca">
                    <div class="accordion" id="accSeguranca">
                        <div class="accordion-item faq-item" data-tags="seguranca protecao conta 2fa password">
                            <h2 class="accordion-header" id="s1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#s1" aria-controls="s1">
                                    Como protegem a minha conta?
                                </button>
                            </h2>
                            <div id="s1" class="accordion-collapse collapse show" data-bs-parent="#accSeguranca">
                                <div class="accordion-body">
                                    Usamos ASP.NET Identity, passwords hash, lockout após tentativas falhadas e 2FA opcional. Cookies são HttpOnly e sessões podem ser terminadas em Perfil &gt; Segurança &gt; Sessões Ativas.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="denuncia fraude abuso reportar">
                            <h2 class="accordion-header" id="s2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#s2" aria-controls="s2">
                                    Como denunciar abuso ou fraude?
                                </button>
                            </h2>
                            <div id="s2" class="accordion-collapse collapse" data-bs-parent="#accSeguranca">
                                <div class="accordion-body">
                                    Use o botão “Denunciar” no anúncio ou perfil do utilizador, indicando motivo e evidências. A equipa revê, pode suspender o anúncio ou o utilizador e notifica as partes envolvidas.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dados e Privacidade -->
                <div class="tab-pane fade" id="cat-privacidade">
                    <div class="accordion" id="accPrivacidade">
                        <div class="accordion-item faq-item" data-tags="dados pessoais privacidade gdpr">
                            <h2 class="accordion-header" id="d1h">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#d1" aria-controls="d1">
                                    Que dados recolhem e como são usados?
                                </button>
                            </h2>
                            <div id="d1" class="accordion-collapse collapse show" data-bs-parent="#accPrivacidade">
                                <div class="accordion-body">
                                    Guardamos dados de conta, anúncios, mensagens e reservas para operar o marketplace. Não partilhamos dados pessoais com terceiros sem consentimento. Pode pedir exportação ou remoção dos dados via suporte.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item faq-item" data-tags="email notificacoes newsletter cancelar">
                            <h2 class="accordion-header" id="d2h">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#d2" aria-controls="d2">
                                    Posso controlar notificações por email?
                                </button>
                            </h2>
                            <div id="d2" class="accordion-collapse collapse" data-bs-parent="#accPrivacidade">
                                <div class="accordion-body">
                                    Sim. Em Perfil &gt; Definições ajuste notificações por email e alertas de favoritos/pesquisas. Pode também sair da newsletter a qualquer momento.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        (function () {
            const search = document.getElementById('faqSearch');
            const items = document.querySelectorAll('.faq-item');
            function norm(s) { return (s || '').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, ''); }
            function applyFilter() {
                const q = norm(search.value);
                items.forEach(it => {
                    const txt = norm(it.textContent + ' ' + (it.getAttribute('data-tags') || ''));
                    it.style.display = q.length < 2 || txt.includes(q) ? '' : 'none';
                });
            }
            if (search) {
                search.addEventListener('input', applyFilter);
            }

            const openChatBtn = document.getElementById('openChatFromFaq');
            if (openChatBtn) {
                openChatBtn.addEventListener('click', function () {
                    const t = document.getElementById('chatWidgetToggle');
                    if (t) t.click();
                });
            }
        })();
    </script>
}
