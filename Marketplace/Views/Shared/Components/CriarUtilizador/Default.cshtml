<!-- Cabeçalho -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h3 class="mb-1 fw-bold">
            <i class="bi bi-person-plus-fill text-primary me-2"></i>Criar Novo Utilizador
        </h3>
        <p class="text-muted mb-0">Adicionar manualmente um novo utilizador à plataforma</p>
    </div>
</div>

<!-- Mensagens de Feedback -->
@if (TempData["UserSuccess"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        <strong>@TempData["UserSuccess"]</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (TempData["UserWarning"] != null)
{
    <div class="alert alert-warning alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        <strong>@TempData["UserWarning"]</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="mb-0 fw-bold text-primary">Preencha os dados do utilizador</h5>
            </div>
            <div class="card-body p-4">
                <form method="post" asp-controller="Administrador" asp-action="CriarUtilizador">
                    @Html.AntiForgeryToken()
                    
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="novoNome" class="form-label">Nome Completo <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="novoNome" name="nome" required placeholder="Ex: João Silva">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="novoEmail" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="novoEmail" name="email" required placeholder="Ex: joao@email.com">
                        </div>

                        <div class="col-md-6">
                            <label for="novaPassword" class="form-label">Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control" id="novaPassword" name="password" required placeholder="Mínimo 6 caracteres">
                        </div>

                        <div class="col-md-6">
                            <label for="novoTipo" class="form-label">Tipo de Conta <span class="text-danger">*</span></label>
                            <select class="form-select" id="novoTipo" name="tipo" required onchange="toggleAdminFields()">
                                <option value="" selected disabled>Selecione o tipo...</option>
                                <option value="Comprador">Comprador</option>
                                <option value="Vendedor">Vendedor</option>
                                @if (ViewBag.NivelAcesso == "Nivel 1")
                                {
                                    <option value="Administrador">Administrador</option>
                                }
                            </select>
                        </div>

                        <div class="col-12" id="nifSection">
                            <label for="novoNif" class="form-label">NIF (Apenas para Vendedores)</label>
                            <input type="text" class="form-control" id="novoNif" name="nif" placeholder="Ex: 123456789">
                            <div class="form-text">O NIF é opcional para compradores e administradores.</div>
                        </div>

                        @if (ViewBag.NivelAcesso == "Nivel 1")
                        {
                            <div class="col-12 mt-3" id="adminLevelSection" style="display: none;">
                                <div class="alert alert-warning">
                                    <h6 class="alert-heading fw-bold">
                                        <i class="bi bi-shield-lock-fill me-2"></i>Nível de Acesso do Administrador
                                    </h6>
                                    <div class="form-check mb-2">
                                        <input class="form-check-input" type="radio" name="nivelAcesso" id="nivel2" value="Nivel 2" checked>
                                        <label class="form-check-label" for="nivel2">
                                            <strong>Nível 2</strong> - Gestão de utilizadores, denúncias e validação.
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="nivelAcesso" id="nivel1" value="Nivel 1">
                                        <label class="form-check-label" for="nivel1">
                                            <strong>Nível 1</strong> - Acesso total, incluindo criar novos administradores.
                                        </label>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                    <script>
                        function toggleAdminFields() {
                            const tipo = document.getElementById('novoTipo').value;
                            const adminSection = document.getElementById('adminLevelSection');
                            
                            if (adminSection) {
                                if (tipo === 'Administrador') {
                                    adminSection.style.display = 'block';
                                } else {
                                    adminSection.style.display = 'none';
                                }
                            }
                        }
                    </script>

                    <div class="d-flex justify-content-end mt-4 pt-3 border-top">
                        <button type="reset" class="btn btn-light me-2">Limpar</button>
                        <button type="submit" class="btn btn-primary px-4">
                            <i class="bi bi-check-lg me-1"></i>Criar Utilizador
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
